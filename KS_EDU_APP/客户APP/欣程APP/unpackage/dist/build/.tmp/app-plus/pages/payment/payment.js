(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/payment/payment"],{1432:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},r=[];a.d(t,"a",function(){return n}),a.d(t,"b",function(){return r})},"32f6":function(e,t,a){"use strict";var n=a("5653"),r=a.n(n);r.a},"4f40":function(e,t,a){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a("b33c"),i=a("0f77"),o={name:"payment",data:function(){return{baseUrl:this.$store.state.SRC+"/config/app",payStatus:0,webUrl:"",webTitle:"",defaultPaymentid:0,orderInfo:{}}},onLoad:function(t){var a=this,n=getCurrentPages(),r=n[n.length-2];"pages/web/web"===r.route&&(r.$vm.refresh=!1);var o=t.orderid;(0,i.CheckOrder)({orderid:o,ordertype:t.ordertype||0}).then(function(t){if(t.result)switch(a.defaultPaymentid=t.paymentid,Number(t.status)){case 1:a.webUrl=t.weburl,a.webTitle=t.title,a.onPaySuccess();break;default:a.orderInfo=t,a.orderPay()}else a.$msg(t.msg).then(function(){e.navigateBack()})})},methods:{open:function(){e.navigateTo({url:"/pages/user/order/index"})},goBack:function(){e.navigateBack()},onPaySuccess:function(){var e=this;this.$store.dispatch("getUserInfo").then(function(){e.payStatus=1})},openOrder:function(){e.navigateTo({url:"/pages/user/order/index"})},orderPay:function(){var e=this.orderInfo;switch(Number(e.payment)){case 0:15==this.defaultPaymentid?this.aliPay(e):this.appWechatPay(e);break;case 15:this.appWechatPay(e);break;case 8:this.aliPay(e);break}},aliPay:function(t){var a=this;this.payStatus=3,(0,r.XiaDanAliPay)({ordertype:1,orderid:t.courseorder}).then(function(t){t.result?e.requestPayment({provider:"alipay",orderInfo:t.data,success:function(e){a.onPaySuccess()},fail:function(e){console.log(n(JSON.stringify(e)," at pages\\payment\\payment.vue:162")),a.payStatus=2}}):a.$msg(t.msg)})},appWechatPay:function(t){var a=this;this.payStatus=3,(0,r.WechatPay)({money:t.ordertotalprice,payorderid:t.courseorder,ordertype:1,platid:15}).then(function(t){if(!t.result)return a.$msg(t.msg),void(a.payStatus=2);e.requestPayment({provider:"wxpay",orderInfo:{appid:t.appid,partnerid:t.partnerid,prepayid:t.prepayid,package:"Sign=WXPay",noncestr:t.noncestr,timestamp:t.timestamp,sign:t.sign},success:function(e){a.onPaySuccess()},fail:function(e){a.payStatus=2}})})},mpWechatPay:function(e){var t=this;console.log(n(e," at pages\\payment\\payment.vue:210")),this.payStatus=3,this.$store.dispatch("getWechatOpenID").then(function(a){"unableget"===a?t.$msg("获取openId出错，请联系管理员"):(0,r.XiaDanWeiPay)({money:e.ordertotalprice,openid:a,ordertype:1,payorderid:e.courseorder,platid:15}).then(function(e){e.result?t.getSignToWeiPay(e.prepay_id).then(function(e){wx.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(e){t.onPaySuccess()},fail:function(e){t.payStatus=2}})}):t.$msg(e.msg)})})},getSignToWeiPay:function(e,t){var a=this;return new Promise(function(n){(0,r.GetWeiPaySign)({repay_id:e,type:t}).then(function(e){e.result?n(e):a.$msg(e.msg)})})}}};t.default=o}).call(this,a("6e42")["default"],a("0de9")["default"])},5653:function(e,t,a){},a310:function(e,t,a){"use strict";a.r(t);var n=a("1432"),r=a("e251");for(var i in r)"default"!==i&&function(e){a.d(t,e,function(){return r[e]})}(i);a("32f6");var o=a("2877"),s=Object(o["a"])(r["default"],n["a"],n["b"],!1,null,"2b79219f",null);t["default"]=s.exports},a9c4:function(e,t,a){"use strict";(function(e){a("661b"),a("921b");n(a("66fd"));var t=n(a("a310"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},e251:function(e,t,a){"use strict";a.r(t);var n=a("4f40"),r=a.n(n);for(var i in n)"default"!==i&&function(e){a.d(t,e,function(){return n[e]})}(i);t["default"]=r.a}},[["a9c4","common/runtime","common/vendor"]]]);